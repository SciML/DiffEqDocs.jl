<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Function Definition Macros · DifferentialEquations.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/default.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Ubuntu+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script></head><body><nav class="toc"><h1>DifferentialEquations.jl</h1><form class="search" action="../search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../index.html">Home</a></li><li><span class="toctext">Tutorials</span><ul><li><a class="toctext" href="../tutorials/ode_example.html">Ordinary Differential Equations (ODE)</a></li><li><a class="toctext" href="../tutorials/sde_example.html">Stochastic Differential Equations (SDE)</a></li><li><a class="toctext" href="../tutorials/dae_example.html">Differential Algebraic Equations (DAE)</a></li><li><a class="toctext" href="../tutorials/fempoisson_example.html">Poisson Equation Finite Element Method</a></li><li><a class="toctext" href="../tutorials/femheat_example.html">Heat Equation Finite Element Method</a></li><li><a class="toctext" href="../tutorials/femstochastic_example.html">Stochastic Finite Element Method</a></li></ul></li><li><span class="toctext">Basics</span><ul><li><a class="toctext" href="../basics/overview.html">Overview of DifferentialEquations.jl</a></li><li><a class="toctext" href="../basics/common_solver_opts.html">Common Solver Options</a></li><li><a class="toctext" href="../basics/solution.html">Solution Handling</a></li><li><a class="toctext" href="../basics/plot.html">Plot Functions</a></li></ul></li><li><span class="toctext">Problem Types</span><ul><li><a class="toctext" href="../problems/ODEProblem.html">Defining an ODE Problem</a></li><li><a class="toctext" href="../problems/SDEProblem.html">Defining a SDE Problem</a></li><li><a class="toctext" href="../problems/FEMProblem.html">Defining a FEM Problem</a></li><li><a class="toctext" href="../problems/StokesProblem.html">Defining a Stokes Problem</a></li></ul></li><li><span class="toctext">Solver Options</span><ul><li><a class="toctext" href="../solvers/ode_solve.html">Ordinary Differential Equation Solvers</a></li><li><a class="toctext" href="../solvers/sde_solve.html">Stochastic Differential Equation Solvers</a></li><li><a class="toctext" href="../solvers/dae_solve.html">Differential Algebraic Equation Solvers</a></li><li><a class="toctext" href="../solvers/fempoisson_solve.html">Finite Element Method Poisson Equation Solvers</a></li><li><a class="toctext" href="../solvers/femheat_solve.html">Finite Element Method Heat Equation Solvers</a></li><li><a class="toctext" href="../solvers/fdmstokes_solve.html">Finite Difference Method Stokes Equation Solvers</a></li></ul></li><li><span class="toctext">Manual</span><ul><li><a class="toctext" href="../man/mesh.html">Meshes</a></li><li><a class="toctext" href="../man/output_specification.html">Output Specification</a></li><li><a class="toctext" href="../man/callback_functions.html">Event Handling and Callback Functions</a></li><li><a class="toctext" href="../man/conditional_dependencies.html">Conditional Dependencies</a></li><li><a class="toctext" href="../man/progress_bar.html">Juno Progress Bar Integration</a></li></ul></li><li><span class="toctext">Add-Ons</span><ul><li><a class="toctext" href="parameter_estimation.html">Parameter Estimation</a></li><li><a class="toctext" href="sensitivity.html">Sensitivity Analysis</a></li><li class="current"><a class="toctext" href="function_definition_macros.html">Function Definition Macros</a><ul class="internal"></ul></li><li><a class="toctext" href="dev_and_test.html">Algorithm Development and Testing Tools</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Add-Ons</li><li><a href="function_definition_macros.html">Function Definition Macros</a></li></ul><a class="edit-page" href="https://github.com/JuliaDiffEq/DiffEqDocs.jl/tree/5370f714e24a96ddb6e47682f780c8d8d6c475a0/docs/src/addons/function_definition_macros.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/></header><h1><a class="nav-anchor" id="Function-Definition-Macros-1" href="#Function-Definition-Macros-1">Function Definition Macros</a></h1><p>DifferentialEquations.jl provides a set of macros for more easily and legibly defining your differential equations. It exploits the standard notation for mathematically writing differential equations and the notation for &quot;punching differential equations into the computer&quot;; effectively doing the translation step for you. This is best shown by an example. Say we want to solve the <a href="http://www.radford.edu/~thompson/vodef90web/problems/demosnodislin/Single/DemoRobertson/demorobertson.pdf">ROBER model</a>. Using the <code>@ode_define</code> macro, we can do this by writing:</p><pre><code class="language-julia">f = @ode_define begin
  dy₁ = -k₁*y₁+k₃*y₂*y₃
  dy₂ =  k₁*y₁-k₂*y₂^2-k₃*y₂*y₃
  dy₃ =  k₂*y₂^2
end k₁=&gt;0.04 k₂=&gt;3e7 k₃=&gt;1e4</code></pre><p>This looks just like psudocode! The macro will expand this to the &quot;standard form&quot;, i.e. the ugly computer form:</p><pre><code class="language-julia">f = (t,u,du) -&gt; begin
  du[1] = -0.04*u[1] + 1e4*u[2]*u[3]
  du[2] = 0.04*u[1] - 3e7*u[2]^2 - 1e4*u[2]*u[3]
  du[3] = 3e7*u[2]^2
end</code></pre><p>Note that one doesn&#39;t need to use numbered variables: DifferentialEquations.jl will number the variables for you. For example, the follows defines the function for the Lotka-Voltera model:</p><pre><code class="language-julia">f = @ode_define begin
  dx = a*x - b*x*y
  dy = -c*y + d*x*y
end a=1.5 b=1 c=3 d=1</code></pre><p>The other macro which is currently provided is the <code>@fem_define</code> macro. This macro is for parsing and writing FEM functions. For example, in the FEM methods you have to use <code>x[:,1]</code> instead of <code>x</code> and <code>x[:,2]</code> instead of <code>y</code>. The macro will automatically do this replacement, along with adding in parameters. Since FEM functions are more general, we also have to give it the function signature. Using the macro looks like this:</p><pre><code class="language-julia">f  = @fem_define (x) begin
  sin(α.*x).*cos(α.*y)
end α=&gt;2π
gD = @fem_define (x) begin
  sin(α.*x).*cos(α.*y)/β
end α=&gt;2π β=&gt;8π*π</code></pre><p>This is equivalent to the definition</p><pre><code class="language-julia">f(x) = sin(2π.*x[:,1]).*cos(2π.*x[:,2])
gD(x) = sin(2π.*x[:,1]).*cos(2π.*x[:,2])/(8π*π)</code></pre><p>The true power comes in when dealing with nonlinear equations. The second argument, which we skipped over as <code>()</code>, is for listing the variables you wish to define the equation by. Mathematically you may be using <code>u</code>,<code>v</code>,<code>w</code>, etc., but for array-based algorithms you need to use <code>u[:,1]</code>,<code>u[:,2]</code>,etc. To avoid obfuscated code, the <code>@fem_define</code> macro does this conversion. For example:</p><pre><code class="language-julia">l = @fem_define (t,x,u) begin
  du = ones(length(u))-α*u
  dv = ones(length(v))-v
end α=&gt;0.5</code></pre><p>says there are two equations, one for <code>u</code>: (<code>ones(length(u))-α*u</code>) and one for <code>v</code>: <code>(ones(length(v))-v)</code>. This expands to the equation</p><pre><code class="language-julia">l = (t,x,u)  -&gt; [ones(size(x,1))-.5u[:,1]   ones(size(x,1))-u[:,2]]</code></pre><p>When you have 10+ variables, using <code>@fem_define</code> leads to code which is much easier to read!</p><footer><hr/><a class="previous" href="sensitivity.html"><span class="direction">Previous</span><span class="title">Sensitivity Analysis</span></a><a class="next" href="dev_and_test.html"><span class="direction">Next</span><span class="title">Algorithm Development and Testing Tools</span></a></footer></article></body></html>
