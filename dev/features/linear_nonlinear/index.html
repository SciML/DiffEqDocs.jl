<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Specifying (Non)Linear Solvers and Preconditioners · DifferentialEquations.jl</title><meta name="title" content="Specifying (Non)Linear Solvers and Preconditioners · DifferentialEquations.jl"/><meta property="og:title" content="Specifying (Non)Linear Solvers and Preconditioners · DifferentialEquations.jl"/><meta property="twitter:title" content="Specifying (Non)Linear Solvers and Preconditioners · DifferentialEquations.jl"/><meta name="description" content="Documentation for DifferentialEquations.jl."/><meta property="og:description" content="Documentation for DifferentialEquations.jl."/><meta property="twitter:description" content="Documentation for DifferentialEquations.jl."/><meta property="og:url" content="https://docs.sciml.ai/DiffEqDocs/stable/features/linear_nonlinear/"/><meta property="twitter:url" content="https://docs.sciml.ai/DiffEqDocs/stable/features/linear_nonlinear/"/><link rel="canonical" href="https://docs.sciml.ai/DiffEqDocs/stable/features/linear_nonlinear/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DifferentialEquations.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DifferentialEquations.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">DifferentialEquations.jl: Efficient Differential Equation Solving in Julia</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started with Differential Equations in Julia</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/faster_ode_example/">Code Optimization for Differential Equations</a></li><li><a class="tocitem" href="../../tutorials/advanced_ode_example/">Solving Large Stiff Equations</a></li><li><a class="tocitem" href="../../tutorials/sde_example/">Stochastic Differential Equations</a></li><li><a class="tocitem" href="../../tutorials/rode_example/">Random Ordinary Differential Equations</a></li><li><a class="tocitem" href="../../tutorials/dde_example/">Delay Differential Equations</a></li><li><a class="tocitem" href="../../tutorials/dae_example/">Differential Algebraic Equations</a></li><li><a class="tocitem" href="../../tutorials/jump_diffusion/">Jump Diffusion Equations</a></li><li><a class="tocitem" href="../../tutorials/bvp_example/">Boundary Value Problems</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Beginner</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/classical_physics/">Classical Physics Models</a></li><li><a class="tocitem" href="../../examples/conditional_dosing/">Conditional Dosing in Pharmacometrics</a></li><li><a class="tocitem" href="../../examples/kepler_problem/">The Kepler Problem</a></li><li><a class="tocitem" href="../../examples/outer_solar_system/">Simulating the Outer Solar System</a></li><li><a class="tocitem" href="../../examples/min_and_max/">Finding Maxima and Minima of ODEs Solutions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Advanced</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/spiking_neural_systems/">Spiking Neural Systems</a></li><li><a class="tocitem" href="../../examples/beeler_reuter/">An Implicit/Explicit CUDA-Accelerated Solver for the 2D Beeler-Reuter Model</a></li><li><a class="tocitem" href="../../examples/diffusion_implicit_heat_equation/">Solving the heat equation with diffusion-implicit time-stepping</a></li></ul></li></ul></li><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="../../basics/overview/">Overview of DifferentialEquations.jl</a></li><li><a class="tocitem" href="../../basics/common_solver_opts/">Common Solver Options (Solve Keyword Arguments)</a></li><li><a class="tocitem" href="../../basics/solution/">Solution Handling</a></li><li><a class="tocitem" href="../../basics/plot/">Plot Functions</a></li><li><a class="tocitem" href="../../basics/integrator/">Integrator Interface</a></li><li><a class="tocitem" href="../../basics/problem/">Problem Interface</a></li><li><a class="tocitem" href="../../basics/faq/">Frequently Asked Questions</a></li><li><a class="tocitem" href="../../basics/compatibility_chart/">Solver Compatibility Chart</a></li></ul></li><li><span class="tocitem">Problem Types</span><ul><li><a class="tocitem" href="../../types/discrete_types/">Discrete Problems</a></li><li><a class="tocitem" href="../../types/ode_types/">ODE Problems</a></li><li><a class="tocitem" href="../../types/nonautonomous_linear_ode/">Non-autonomous Linear ODE / Lie Group Problems</a></li><li><a class="tocitem" href="../../types/dynamical_types/">Dynamical, Hamiltonian and 2nd Order ODE Problems</a></li><li><a class="tocitem" href="../../types/split_ode_types/">Split ODE Problems</a></li><li><a class="tocitem" href="../../types/steady_state_types/">Steady State Problems</a></li><li><a class="tocitem" href="../../types/bvp_types/">BVP Problems</a></li><li><a class="tocitem" href="../../types/sde_types/">SDE Problems</a></li><li><a class="tocitem" href="../../types/sdae_types/">SDAE Problems</a></li><li><a class="tocitem" href="../../types/rode_types/">RODE Problems</a></li><li><a class="tocitem" href="../../types/dde_types/">DDE Problems</a></li><li><a class="tocitem" href="../../types/sdde_types/">SDDE Problems</a></li><li><a class="tocitem" href="../../types/dae_types/">DAE Problems</a></li></ul></li><li><span class="tocitem">Solver Algorithms</span><ul><li><a class="tocitem" href="../../solvers/discrete_solve/">Discrete Solvers</a></li><li><a class="tocitem" href="../../solvers/ode_solve/">ODE Solvers</a></li><li><a class="tocitem" href="../../solvers/nonautonomous_linear_ode/">Non-autonomous Linear ODE / Lie Group ODE Solvers</a></li><li><a class="tocitem" href="../../solvers/dynamical_solve/">Dynamical, Hamiltonian, and 2nd Order ODE Solvers</a></li><li><a class="tocitem" href="../../solvers/split_ode_solve/">Split ODE Solvers</a></li><li><a class="tocitem" href="../../solvers/steady_state_solve/">Steady State Solvers</a></li><li><a class="tocitem" href="../../solvers/bvp_solve/">BVP Solvers</a></li><li><a class="tocitem" href="../../solvers/sde_solve/">SDE Solvers</a></li><li><a class="tocitem" href="../../solvers/sdae_solve/">SDAE Solvers</a></li><li><a class="tocitem" href="../../solvers/rode_solve/">RODE Solvers</a></li><li><a class="tocitem" href="../../solvers/dde_solve/">DDE Solvers</a></li><li><a class="tocitem" href="../../solvers/sdde_solve/">SDDE Solvers</a></li><li><a class="tocitem" href="../../solvers/dae_solve/">Mass Matrix and Fully Implicit DAE Solvers</a></li><li><a class="tocitem" href="../../solvers/benchmarks/">Solver Benchmarks</a></li></ul></li><li><span class="tocitem">Additional Features</span><ul><li><a class="tocitem" href="../performance_overloads/">Jacobians, Gradients, etc.</a></li><li><a class="tocitem" href="../diffeq_arrays/">DiffEq-Specific Array Types</a></li><li><a class="tocitem" href="../diffeq_operator/">Matrix-Free Linear Operators and Specializations on Linearity</a></li><li><a class="tocitem" href="../noise_process/">Noise Processes</a></li><li class="is-active"><a class="tocitem" href>Specifying (Non)Linear Solvers and Preconditioners</a><ul class="internal"><li><a class="tocitem" href="#Linear-Solvers:-linsolve-Specification"><span>Linear Solvers: <code>linsolve</code> Specification</span></a></li><li><a class="tocitem" href="#Preconditioners:-precs-Specification"><span>Preconditioners: <code>precs</code> Specification</span></a></li><li><a class="tocitem" href="#Nonlinear-Solvers:-nlsolve-Specification"><span>Nonlinear Solvers: <code>nlsolve</code> Specification</span></a></li></ul></li><li><a class="tocitem" href="../callback_functions/">Event Handling and Callback Functions</a></li><li><a class="tocitem" href="../callback_library/">Callback Library</a></li><li><a class="tocitem" href="../ensemble/">Parallel Ensemble Simulations</a></li><li><a class="tocitem" href="../io/">I/O: Saving and Loading Solution Data</a></li><li><a class="tocitem" href="../low_dep/">Reduced Compile Time, Optimizing Runtime, and Low Dependency Usage</a></li><li><a class="tocitem" href="../progress_bar/">Progress Bar Integration</a></li></ul></li><li><span class="tocitem">Detailed Solver APIs</span><ul><li><a class="tocitem" href="../../api/sundials/">Sundials.jl</a></li><li><a class="tocitem" href="../../api/daskr/">DASKR.jl</a></li></ul></li><li><span class="tocitem">Extra Details</span><ul><li><a class="tocitem" href="../../extras/timestepping/">Timestepping Method Descriptions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Additional Features</a></li><li class="is-active"><a href>Specifying (Non)Linear Solvers and Preconditioners</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Specifying (Non)Linear Solvers and Preconditioners</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SciML/DiffEqDocs.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SciML/DiffEqDocs.jl/blob/master/docs/src/features/linear_nonlinear.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="linear_nonlinear"><a class="docs-heading-anchor" href="#linear_nonlinear">Specifying (Non)Linear Solvers and Preconditioners</a><a id="linear_nonlinear-1"></a><a class="docs-heading-anchor-permalink" href="#linear_nonlinear" title="Permalink"></a></h1><p>One of the key features of DifferentialEquations.jl is its flexibility. Keeping with this trend, many of the native Julia solvers provided by DifferentialEquations.jl allow you to choose the method for linear and nonlinear solving. This section details how to make that choice.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>We highly recommend looking at the <a href="../../tutorials/advanced_ode_example/#stiff">Solving Large Stiff Equations</a> tutorial, which goes through these options in a real-world example.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>These options do not apply to the Sundials differential equation solvers (<code>CVODE_BDF</code>, <code>CVODE_Adams</code>, <code>ARKODE</code>, and <code>IDA</code>). For complete descriptions of similar functionality for Sundials, see the <a href="../../solvers/ode_solve/#ode_solve_sundials">Sundials ODE solver documentation</a> and <a href="../../solvers/dae_solve/#dae_solve_sundials">Sundials DAE solver documentation</a>.</p></div></div><h2 id="Linear-Solvers:-linsolve-Specification"><a class="docs-heading-anchor" href="#Linear-Solvers:-linsolve-Specification">Linear Solvers: <code>linsolve</code> Specification</a><a id="Linear-Solvers:-linsolve-Specification-1"></a><a class="docs-heading-anchor-permalink" href="#Linear-Solvers:-linsolve-Specification" title="Permalink"></a></h2><p>For linear solvers, DifferentialEquations.jl uses <a href="https://github.com/SciML/LinearSolve.jl">LinearSolve.jl</a>. Any <a href="https://linearsolve.sciml.ai/dev/solvers/solvers/">LinearSolve.jl algorithm</a> can be used as the linear solver simply by passing the algorithm choice to linsolve. For example, the following tells <code>TRBDF2</code> to use <a href="https://github.com/JuliaSparse/KLU.jl">KLU.jl</a></p><pre><code class="language-julia hljs">TRBDF2(linsolve = KLUFactorization())</code></pre><p>Many choices exist, including GPU offloading, so consult the <a href="https://linearsolve.sciml.ai/dev/">LinearSolve.jl documentation</a> for more details on the choices.</p><h2 id="Preconditioners:-precs-Specification"><a class="docs-heading-anchor" href="#Preconditioners:-precs-Specification">Preconditioners: <code>precs</code> Specification</a><a id="Preconditioners:-precs-Specification-1"></a><a class="docs-heading-anchor-permalink" href="#Preconditioners:-precs-Specification" title="Permalink"></a></h2><p>Any <a href="https://docs.sciml.ai/LinearSolve/stable/basics/Preconditioners/">LinearSolve.jl-compatible preconditioner</a> can be used as a left or right preconditioner. Preconditioners are specified by the <code>Pl,Pr = precs(W,du,u,p,t,newW,Plprev,Prprev,solverdata)</code> function where the arguments are defined as:</p><ul><li><code>W</code>: the current Jacobian of the nonlinear system. Specified as either <span>$I - \gamma J$</span> or <span>$I/\gamma - J$</span> depending on the algorithm. This will commonly be a <code>WOperator</code> type defined by OrdinaryDiffEq.jl. It is a lazy representation of the operator. Users can construct the W-matrix on demand by calling <code>convert(AbstractMatrix,W)</code> to receive an <code>AbstractMatrix</code> matching the <code>jac_prototype</code>.</li><li><code>du</code>: the current ODE derivative</li><li><code>u</code>: the current ODE state</li><li><code>p</code>: the ODE parameters</li><li><code>t</code>: the current ODE time</li><li><code>newW</code>: a <code>Bool</code> which specifies whether the <code>W</code> matrix has been updated since the last call to <code>precs</code>. It is recommended that this is checked to only update the preconditioner when <code>newW == true</code>.</li><li><code>Plprev</code>: the previous <code>Pl</code>.</li><li><code>Prprev</code>: the previous <code>Pr</code>.</li><li><code>solverdata</code>: Optional extra data the solvers can give to the <code>precs</code> function. Solver-dependent and subject to change.</li></ul><p>The return is a tuple <code>(Pl,Pr)</code> of the LinearSolve.jl-compatible preconditioners. To specify one-sided preconditioning, simply return <code>nothing</code> for the preconditioner which is not used.</p><p>Additionally, <code>precs</code> must supply the dispatch:</p><pre><code class="language-julia hljs">Pl, Pr = precs(W, du, u, p, t, ::Nothing, ::Nothing, ::Nothing, solverdata)</code></pre><p>which is used in the solver setup phase to construct the integrator type with the preconditioners <code>(Pl,Pr)</code>.</p><p>The default is <code>precs=DEFAULT_PRECS</code> where the default preconditioner function is defined as:</p><pre><code class="language-julia hljs">DEFAULT_PRECS(W, du, u, p, t, newW, Plprev, Prprev, solverdata) = nothing, nothing</code></pre><h2 id="Nonlinear-Solvers:-nlsolve-Specification"><a class="docs-heading-anchor" href="#Nonlinear-Solvers:-nlsolve-Specification">Nonlinear Solvers: <code>nlsolve</code> Specification</a><a id="Nonlinear-Solvers:-nlsolve-Specification-1"></a><a class="docs-heading-anchor-permalink" href="#Nonlinear-Solvers:-nlsolve-Specification" title="Permalink"></a></h2><p>All the Julia-based implicit solvers (OrdinaryDiffEq.jl, StochasticDiffEq.jl, etc.) allow for choosing the nonlinear solver that is used to handle the implicit system. While fully modifiable and customizable, most users should stick to the pre-defined nonlinear solver choices. These are:</p><ul><li><code>NLNewton(; κ = 1 // 100, max_iter = 10, fast_convergence_cutoff = 1 // 5, new_W_dt_cutoff = 1 // 5, always_new = false, check_div = true, relax = 0 // 1)</code>: A quasi-Newton method. The default.</li><li><code>NLAnderson(; κ=1//100, max_iter=10, max_history::Int=5, aa_start::Int=1, droptol=nothing, fast_convergence_cutoff=1//5)</code>: Anderson acceleration. While more stable than functional iteration, this method is less stable than Newton&#39;s method, but does not require a Jacobian.</li><li><code>NLFunctional(; κ=1//100, max_iter=10, fast_convergence_cutoff=1//5)</code>: This method is the least stable, but does not require a Jacobian. It should only be used for non-stiff ODEs.</li></ul><p>The <code>NLNewton</code> solver allows for relaxation via the <code>relax</code> keyword parameter. Numerical values of <code>relax</code> must lie in the half open unit interval <code>[0,1)</code> where <code>0</code> corresponds to no relaxation. Alternatively, <code>relax</code> may be set to a line search algorithm from <a href="https://julianlsolvers.github.io/LineSearches.jl/stable/">LineSearches.jl</a> in order to include a line search relaxation step in the Newton iterations. For example, the well known Newton-Armijo iterative scheme can be employed by setting <code>relax=BackTracking()</code> where <code>BackTracking</code> is provided by <code>LineSearches</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../noise_process/">« Noise Processes</a><a class="docs-footer-nextpage" href="../callback_functions/">Event Handling and Callback Functions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.9.0 on <span class="colophon-date" title="Sunday 30 March 2025 16:51">Sunday 30 March 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
